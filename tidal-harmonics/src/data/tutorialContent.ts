import type { TutorialChapter } from '@/types/tutorial';

export const TUTORIAL_CHAPTERS: TutorialChapter[] = [
  {
    id: 'ch1-moon-gravity',
    title: 'The Moon\'s Pull',
    description: "Understanding gravitational tides",
    steps: [
      {
        id: 'ch1-intro',
        title: 'The Eternal Dance',
        content: "Watch the Moon orbit Earth. Its gravity reaches across 384,000 km to pull on our oceans.",
        duration: 6,
        camera: { position: [50, 30, 50], target: [0, 0, 0], duration: 2 },
        showTidalBulge: false,
        showForceVectors: false,
        showOrbits: true,
        timeSpeed: 172800, // 2 days/sec
      },
      {
        id: 'ch1-zoom',
        title: 'Zooming In',
        content: "The Moon pulls water toward itself, but something surprising happens...",
        duration: 5,
        camera: { position: [35, 12, 35], target: [0, 0, 0], duration: 2 },
        showTidalBulge: false,
        timeSpeed: 3600,
      },
      {
        id: 'ch1-bulge-reveal',
        title: 'The Tidal Bulge',
        content: "Water bulges toward the Moon. We're exaggerating this 50,000× — the real bulge is only half a meter!",
        duration: 7,
        camera: { position: [20, 8, 20], target: [0, 0, 0], duration: 1.5 },
        showTidalBulge: true,
        tidalExaggeration: 50000,
        timeSpeed: 0,
        highlightMoon: true,
        annotations: [
          { id: 'bulge1', text: '← Pulled toward Moon', position: [3.5, 0, 0], style: 'highlight' },
        ],
      },
      {
        id: 'ch1-second-bulge',
        title: 'The Surprising Second Bulge',
        content: "There's also a bulge on the OPPOSITE side! Earth accelerates toward the Moon faster than this distant water.",
        duration: 8,
        camera: { position: [-20, 12, 25], target: [0, 0, 0], duration: 2.5 },
        showTidalBulge: true,
        tidalExaggeration: 70000,
        showForceVectors: true,
        timeSpeed: 0,
        annotations: [
          { id: 'bulge2', text: 'Second bulge →', position: [-3.5, 0, 0], style: 'highlight' },
        ],
      },
      {
        id: 'ch1-differential',
        title: 'Differential Gravity',
        content: "The arrows show tidal forces — they point OUTWARD on both sides. This stretches Earth into an egg shape.",
        duration: 7,
        camera: { position: [0, 35, 35], target: [0, 0, 0], duration: 2 },
        showTidalBulge: true,
        tidalExaggeration: 60000,
        showForceVectors: true,
        timeSpeed: 0,
      },
      {
        id: 'ch1-rotation',
        title: 'Two Tides Per Day',
        content: "Earth rotates beneath the bulges. Any coastal point passes through TWO high tides every 24 hours 50 minutes.",
        duration: 10,
        camera: { position: [0, 30, 35], target: [0, 0, 0], duration: 1.5 },
        showTidalBulge: true,
        tidalExaggeration: 75000,
        showForceVectors: false,
        timeSpeed: 10800, // 3 hrs/sec - watch rotation clearly
        pulseEffect: true,
      },
    ],
  },
  {
    id: 'ch2-sun',
    title: 'The Sun\'s Role',
    description: 'Spring and neap tides',
    steps: [
      {
        id: 'ch2-intro',
        title: 'Another Player',
        content: "The Sun also pulls on our oceans. Its tidal effect is 46% as strong as the Moon's.",
        duration: 6,
        camera: { position: [0, 350, 250], target: [0, 0, 0], duration: 2.5 },
        showTidalBulge: false,
        showOrbits: true,
        timeSpeed: 0,
        highlightSun: true,
      },
      {
        id: 'ch2-alignment',
        title: 'When They Align',
        content: "At new and full Moon, Sun and Moon pull together. Their forces ADD up.",
        duration: 7,
        camera: { position: [0, 150, 120], target: [0, 0, 0], duration: 2 },
        showTidalBulge: true,
        tidalExaggeration: 90000,
        highlightSun: true,
        showForceVectors: true,
        timeSpeed: 0,
        annotations: [
          { id: 'spring', text: 'SPRING TIDE', position: [0, 6, 0], style: 'highlight' },
        ],
      },
      {
        id: 'ch2-spring',
        title: 'Spring Tides',
        content: "Maximum tidal range! 'Spring' means to leap up — nothing to do with the season.",
        duration: 6,
        camera: { position: [40, 30, 30], target: [0, 0, 0], duration: 1.5 },
        showTidalBulge: true,
        tidalExaggeration: 100000,
        timeSpeed: 0,
        pulseEffect: true,
        highlightSun: true,
        annotations: [
          { id: 'max', text: 'MAXIMUM RANGE', position: [0, 3, 0], style: 'highlight' },
        ],
      },
      {
        id: 'ch2-watch-cycle',
        title: 'The Lunar Month',
        content: "Watch the Moon orbit. Every ~14 days, alignment shifts between spring and neap.",
        duration: 12,
        camera: { position: [0, 55, 45], target: [0, 0, 0], duration: 2 },
        showTidalBulge: true,
        tidalExaggeration: 50000,
        showOrbits: true,
        highlightMoon: true,
        timeSpeed: 518400, // 6 days/sec
      },
      {
        id: 'ch2-neap',
        title: 'Neap Tides',
        content: "At quarter Moon, Sun and Moon pull at 90°. Their forces partially CANCEL. Minimum tidal range.",
        duration: 7,
        camera: { position: [45, 55, 45], target: [0, 0, 0], duration: 2 },
        showTidalBulge: true,
        tidalExaggeration: 35000,
        showForceVectors: true,
        showOrbits: true,
        highlightSun: true,
        highlightMoon: true,
        timeSpeed: 0,
        epoch: 1705320000000, // Jan 15, 2024 12:00 UTC - First Quarter Moon
        annotations: [
          { id: 'neap', text: 'MINIMUM RANGE', position: [0, 5, 0], style: 'highlight' },
        ],
      },
    ],
  },
  {
    id: 'ch3-harmonics',
    title: 'Harmonic Analysis',
    description: 'Breaking down complexity',
    steps: [
      {
        id: 'ch3-complex',
        title: 'Reality is Messy',
        content: "Real tides are complex. Elliptical orbits, tilted axes, continental shelves — many factors combine.",
        duration: 6,
        camera: { position: [50, 35, 50], target: [0, 0, 0], duration: 2 },
        showTidalBulge: true,
        tidalExaggeration: 55000,
        showForceVectors: true,
        showOrbits: true,
        highlightMoon: true,
        highlightSun: true,
        timeSpeed: 172800, // 2 days/sec - show complexity in motion
      },
      {
        id: 'ch3-fourier',
        title: 'The Key Insight',
        content: "Any complex periodic signal can be decomposed into simple sine waves. This is Fourier analysis — the same principle behind FFT, audio compression, and signal processing.",
        duration: 8,
        camera: { position: [30, 20, 30], target: [0, 0, 0], duration: 1.5 },
        showTidalBulge: true,
        tidalExaggeration: 45000,
        timeSpeed: 3600,
        highlightConstituents: ['M2'],
        pulseEffect: true,
        annotations: [
          { id: 'complex', text: 'Complex periodic motion', position: [3.5, 2, 0], style: 'highlight' },
        ],
      },
      {
        id: 'ch3-phasor',
        title: 'The Phasor Diagram',
        content: "Look at the bottom-right panel. Each vector rotates at a different speed. The RED sum is the actual tide!",
        duration: 8,
        camera: { position: [30, 15, 30], target: [0, 0, 0], duration: 1.5 },
        highlightConstituents: ['M2', 'S2'],
        timeSpeed: 7200,
        showPhasorDiagram: true,
      },
      {
        id: 'ch3-m2',
        title: 'M2: The Biggest',
        content: "M2 (Principal Lunar) dominates — typically 60-70% of the tide. Compare its vector length to the others!",
        duration: 8,
        camera: { position: [30, 15, 30], target: [0, 0, 0], duration: 1 },
        highlightConstituents: ['M2', 'S2', 'K1', 'O1'],
        emphasizedConstituent: 'M2',
        timeSpeed: 7200,
        showTidalBulge: true,
        showPhasorDiagram: true,
        tidalExaggeration: 45000,
      },
    ],
  },
  {
    id: 'ch4-constituents',
    title: 'Major Constituents',
    description: 'The tidal orchestra',
    steps: [
      {
        id: 'ch4-s2',
        title: 'S2: The Solar Twin',
        content: "S2 (Principal Solar) has exactly 12h period. When M2 and S2 align: spring tide. When opposed: neap.",
        duration: 8,
        camera: { position: [30, 18, 30], target: [0, 0, 0], duration: 1.5 },
        highlightConstituents: ['M2', 'S2'],
        emphasizedConstituent: 'S2',
        highlightSun: true,
        showPhasorDiagram: true,
        timeSpeed: 86400,
      },
      {
        id: 'ch4-diurnal',
        title: 'K1 & O1: The Diurnals',
        content: "These ~24h constituents cause 'diurnal inequality' — when the two daily highs aren't equal.",
        duration: 7,
        camera: { position: [30, 18, 30], target: [0, 0, 0], duration: 1 },
        highlightConstituents: ['K1', 'O1'],
        emphasizedConstituent: 'K1',
        showPhasorDiagram: true,
        timeSpeed: 7200,
      },
      {
        id: 'ch4-together',
        title: 'The Symphony',
        content: "M2 + S2 + K1 + O1 capture ~85% of most tides. Watch them dance together.",
        duration: 10,
        camera: { position: [35, 22, 35], target: [0, 0, 0], duration: 1.5 },
        highlightConstituents: ['M2', 'S2', 'K1', 'O1'],
        showPhasorDiagram: true,
        timeSpeed: 10800,
        showTidalBulge: true,
        tidalExaggeration: 50000,
      },
    ],
  },
  {
    id: 'ch5-elliptic',
    title: 'Elliptic Orbits',
    description: 'Why distance matters',
    steps: [
      {
        id: 'ch5-ellipse-intro',
        title: 'Not Perfect Circles',
        content: "The Moon's orbit is an ellipse. At perigee it's 356,000 km away; at apogee, 407,000 km.",
        duration: 7,
        camera: { position: [80, 40, 80], target: [0, 0, 0], duration: 2 },
        showOrbits: true,
        timeSpeed: 259200, // 3 days/sec
        annotations: [
          { id: 'perigee', text: 'Perigee (356,000 km)', position: [25, 2, -20], style: 'default' },
          { id: 'apogee', text: 'Apogee (407,000 km)', position: [-28, 2, 22], style: 'default' },
        ],
      },
      {
        id: 'ch5-inverse-cube',
        title: 'The Inverse Cube Law',
        content: "Gravity falls as 1/r². But TIDAL force falls as 1/r³ — that extra power of r is why 14% closer means 48% stronger!",
        duration: 8,
        camera: { position: [40, 20, 40], target: [0, 0, 0], duration: 2 },
        showTidalBulge: true,
        tidalExaggeration: 60000,
        showOrbits: true,
        timeSpeed: 0,
      },
      {
        id: 'ch5-n2',
        title: 'N2: The Elliptic Constituent',
        content: "N2 is M2's sideband — a slightly different frequency that beats against it. Their interference creates amplitude modulation with a 27.6-day period, exactly matching perigee-to-perigee.",
        duration: 8,
        camera: { position: [35, 18, 35], target: [0, 0, 0], duration: 1.5 },
        highlightConstituents: ['M2', 'N2'],
        emphasizedConstituent: 'N2',
        showPhasorDiagram: true,
        timeSpeed: 172800,
      },
      {
        id: 'ch5-king-tides',
        title: 'King Tides',
        content: "When N2 aligns with M2+S2 spring tide: KING TIDE. Because we know the exact frequencies, we can predict these extreme tides years in advance—constructive interference on a schedule.",
        duration: 8,
        camera: { position: [50, 25, 50], target: [0, 0, 0], duration: 2 },
        showTidalBulge: true,
        tidalExaggeration: 100000,
        highlightConstituents: ['M2', 'S2', 'N2'],
        showPhasorDiagram: true,
        timeSpeed: 0,
        pulseEffect: true,
      },
    ],
  },
  {
    id: 'ch6-declination',
    title: 'Orbital Tilts',
    description: 'Why tides vary with declination',
    steps: [
      {
        id: 'ch6-tilt-intro',
        title: 'Tilted Orbits',
        content: "Neither the Moon nor Sun stays over the equator—they bob north and south. This 'declination' breaks the symmetry of each day's two tides, creating K1: a DIURNAL (once-daily) constituent.",
        duration: 8,
        camera: { position: [60, 35, 60], target: [0, 0, 0], duration: 2 },
        showOrbits: true,
        highlightConstituents: ['K1'],
        emphasizedConstituent: 'K1',
        showPhasorDiagram: true,
        timeSpeed: 172800,
      },
      {
        id: 'ch6-inequality',
        title: 'Diurnal Inequality',
        content: "WHY unequal? The bulge tilts with the Moon. As Earth rotates, you pass through DIFFERENT slices of the bulge—one thicker, one thinner. O1 captures this lunar asymmetry, beating with K1 to modulate the inequality over the month.",
        duration: 8,
        camera: { position: [35, 25, 35], target: [0, 0, 0], duration: 1.5 },
        showTidalBulge: true,
        tidalExaggeration: 60000,
        highlightConstituents: ['K1', 'O1'],
        emphasizedConstituent: 'O1',
        showPhasorDiagram: true,
        timeSpeed: 7200,
      },
      {
        id: 'ch6-tropic',
        title: 'Tropic Tides',
        content: "When the Moon reaches maximum declination (near the tropics), the bulge tilts most steeply. One side of Earth barely touches the bulge while the other plunges through. Result: some coasts see only ONE tide per day. P1 (solar diurnal) joins K1 and O1 in creating these 'tropic tides.'",
        duration: 8,
        camera: { position: [35, 35, 35], target: [0, 0, 0], duration: 1.5 },
        showTidalBulge: true,
        tidalExaggeration: 60000,
        highlightConstituents: ['K1', 'O1', 'P1'],
        emphasizedConstituent: 'P1',
        showPhasorDiagram: true,
        timeSpeed: 7200,
      },
      {
        id: 'ch6-k2',
        title: 'K2: Declination Modulation',
        content: "K1 creates the diurnal component—but what happens to the TWICE-daily tide? K2 is the answer. When the Moon sits on the equator, the bulge is symmetric and the semidiurnal tide is at full strength. At max declination, the tilted bulge diverts energy into the diurnal, WEAKENING the twice-daily signal. K2 captures this: it beats with S2 to modulate semidiurnal amplitude over the declination cycle.",
        duration: 8,
        camera: { position: [35, 25, 35], target: [0, 0, 0], duration: 1.5 },
        showTidalBulge: true,
        tidalExaggeration: 60000,
        highlightConstituents: ['M2', 'S2', 'K2'],
        emphasizedConstituent: 'K2',
        showPhasorDiagram: true,
        timeSpeed: 7200,
      },
    ],
  },
  {
    id: 'ch7-shallow',
    title: 'Shallow Water',
    description: 'When the seabed matters',
    steps: [
      {
        id: 'ch7-distortion',
        title: 'Wave Distortion',
        content: "In the deep ocean, M2 propagates as a clean sinusoid. But as the tidal wave enters shallow water—continental shelves, bays, estuaries—the crest travels faster than the trough (more water depth = higher speed). The wave 'steepens': rises quickly, falls slowly. Engineers call this harmonic distortion. Fourier decomposition reveals new frequencies that didn't exist in the deep ocean.",
        duration: 8,
        camera: { position: [40, 22, 40], target: [0, 0, 0], duration: 2 },
        showTidalBulge: true,
        tidalExaggeration: 60000,
        highlightConstituents: ['M2'],
        emphasizedConstituent: 'M2',
        showPhasorDiagram: true,
        timeSpeed: 7200,
      },
      {
        id: 'ch7-m4',
        title: 'M4: The First Overtide',
        content: "M4 is M2's second harmonic—exactly twice the frequency (4 peaks/day instead of 2). It doesn't come from the Moon; it's BORN when M2 steepens in shallow water. The asymmetric waveform (sharp rise, slow fall) can't be represented by a single sinusoid. Fourier analysis reveals hidden harmonics: M4, M6, M8... This is the same physics as audio clipping creating overtones. M4 is pure nonlinear magic.",
        duration: 8,
        camera: { position: [35, 18, 35], target: [0, 0, 0], duration: 1.5 },
        showTidalBulge: true,
        tidalExaggeration: 60000,
        highlightConstituents: ['M2', 'M4'],
        emphasizedConstituent: 'M4',
        showPhasorDiagram: true,
        timeSpeed: 10800,
      },
      {
        id: 'ch7-asymmetry',
        title: 'Flood vs. Ebb',
        content: "Here's where M4 changes everything. M4 has twice M2's frequency, so it cycles 4 times for every 2 M2 cycles. The PHASE relationship determines the asymmetry: when M4 peaks align with M2's rising slope, it steepens the flood (faster rise). When M4 troughs align with M2's falling slope, it stretches the ebb (slower fall). Result: 'fast flood, slow ebb'—or the reverse, depending on local bathymetry. MS4 (from M2+S2 interaction) adds spring/neap modulation. This asymmetry is why some harbors fill twice as fast as they drain.",
        duration: 8,
        camera: { position: [35, 18, 35], target: [0, 0, 0], duration: 1 },
        showTidalBulge: true,
        tidalExaggeration: 60000,
        highlightConstituents: ['M2', 'M4', 'MS4'],
        emphasizedConstituent: 'M4',
        showPhasorDiagram: true,
        timeSpeed: 7200,
      },
      {
        id: 'ch7-bores',
        title: 'Tidal Bores',
        content: "Take the fast-flood asymmetry to the extreme: funnel-shaped estuaries that amplify the tide. When M4's phase causes a VERY fast flood—and the estuary narrows upstream—the rising water literally outruns itself, piling into a breaking wave that surges upriver against the current. This is a tidal bore. The Severn (UK), Qiantang (China), and Amazon (Pororoca) are famous examples. Each bore is a physical manifestation of M4, M6, M8... nonlinear harmonics made dramatically visible. The same Fourier math predicts them.",
        duration: 8,
        camera: { position: [40, 22, 40], target: [0, 0, 0], duration: 1.5 },
        showTidalBulge: true,
        tidalExaggeration: 60000,
        highlightConstituents: ['M2', 'M4', 'M6', 'M8'],
        emphasizedConstituent: 'M4',
        showPhasorDiagram: true,
        timeSpeed: 7200,
      },
    ],
  },
  {
    id: 'ch8-longperiod',
    title: 'Long Period Tides',
    description: 'The slow rhythms',
    steps: [
      {
        id: 'ch8-intro',
        title: 'Beyond Daily Cycles',
        content: "The Moon's orbit changes slowly — its distance, tilt, and orientation all vary over weeks to years. These gradual shifts create long-period tides that modulate the daily rhythm.",
        duration: 8,
        camera: { position: [60, 35, 60], target: [0, 0, 0], duration: 2 },
        showTidalBulge: true,
        tidalExaggeration: 50000,
        showPhasorDiagram: true,
        highlightConstituents: ['Mf', 'Mm', 'Ssa'],
        showOrbits: true,
        timeSpeed: 604800, // 1 week/sec - watch orbital changes unfold
      },
      {
        id: 'ch8-mf',
        title: 'Mf: The Fortnightly',
        content: "Mf has a ~13.7 day period. It slightly raises mean sea level during spring tides.",
        duration: 7,
        camera: { position: [50, 30, 50], target: [0, 0, 0], duration: 1.5 },
        highlightConstituents: ['Mf', 'Mm'],
        timeSpeed: 604800,
      },
      {
        id: 'ch8-seasonal',
        title: 'Ssa & Sa: Seasonal Tides',
        content: "Ssa (6 months) and Sa (1 year) capture seasonal variations — both gravitational and thermal.",
        duration: 8,
        camera: { position: [70, 40, 70], target: [0, 0, 0], duration: 2 },
        highlightConstituents: ['Ssa', 'Sa'],
        timeSpeed: 2592000, // 30 days/sec
      },
      {
        id: 'ch8-climate',
        title: 'Climate Connection',
        content: "Long-period tides affect mean sea level. Critical for separating tides from climate trends.",
        duration: 7,
        camera: { position: [55, 32, 55], target: [0, 0, 0], duration: 1.5 },
        highlightConstituents: ['Mf', 'Mm', 'Ssa', 'Sa', 'MSf'],
        timeSpeed: 604800,
      },
    ],
  },
  {
    id: 'ch9-prediction',
    title: 'Tide Prediction',
    description: 'From analysis to forecast',
    steps: [
      {
        id: 'ch9-local',
        title: 'Every Place is Different',
        content: "Local geography shapes how tides behave. Try different stations in the dropdown!",
        duration: 0, // Manual advance - interactive
        camera: { position: [40, 22, 40], target: [0, 0, 0], duration: 1.5 },
        highlightConstituents: ['M2', 'S2', 'K1', 'O1', 'N2'],
        timeSpeed: 3600,
        interactive: true,
      },
      {
        id: 'ch9-constants',
        title: 'Harmonic Constants',
        content: "Scientists measure years of data to extract each location's unique amplitudes and phases.",
        duration: 6,
        camera: { position: [40, 22, 40], target: [0, 0, 0], duration: 1 },
        highlightConstituents: ['M2', 'S2', 'K1', 'O1', 'N2', 'K2'],
        timeSpeed: 3600,
      },
      {
        id: 'ch9-formula',
        title: 'The Prediction',
        content: "Sum all constituents: height = Σ Aᵢ cos(ωᵢt + φᵢ). Simple math, remarkably accurate!",
        duration: 7,
        camera: { position: [40, 22, 40], target: [0, 0, 0], duration: 1 },
        highlightConstituents: ['M2', 'S2', 'K1', 'O1', 'N2', 'K2', 'P1', 'Q1'],
        timeSpeed: 10800,
      },
      {
        id: 'ch9-kelvin',
        title: 'Lord Kelvin\'s Machine',
        content: "In 1873, Lord Kelvin built a mechanical tide predictor. Gears mimicked constituent frequencies!",
        duration: 8,
        camera: { position: [45, 25, 45], target: [0, 0, 0], duration: 1.5 },
        highlightConstituents: ['M2', 'S2', 'N2', 'K1', 'O1', 'K2'],
        timeSpeed: 0,
      },
      {
        id: 'ch9-doodson',
        title: 'Doodson Numbers',
        content: "Arthur Doodson created a numbering system for constituents. Each number encodes the astronomical origin.",
        duration: 7,
        camera: { position: [40, 22, 40], target: [0, 0, 0], duration: 1 },
        highlightConstituents: ['M2', 'S2', 'K1', 'O1'],
        timeSpeed: 7200,
      },
    ],
  },
  {
    id: 'ch10-explore',
    title: 'Your Turn',
    description: 'Explore freely',
    steps: [
      {
        id: 'ch10-full',
        title: '37 Constituents',
        content: "NOAA uses 37 major constituents. Click any in the phasor diagram to learn more!",
        duration: 8,
        camera: { position: [45, 28, 45], target: [0, 0, 0], duration: 1.5 },
        highlightConstituents: ['M2', 'S2', 'N2', 'K1', 'O1', 'K2', 'P1', 'Q1', 'M4', 'Mf', 'Mm'],
        timeSpeed: 7200,
      },
      {
        id: 'ch10-types',
        title: 'Tide Types',
        content: "Semidiurnal (2 highs/day), Diurnal (1 high/day), or Mixed. Try Seattle vs Boston!",
        duration: 0,
        camera: { position: [40, 22, 40], target: [0, 0, 0], duration: 1.5 },
        highlightConstituents: ['M2', 'S2', 'K1', 'O1'],
        timeSpeed: 7200,
        interactive: true,
      },
      {
        id: 'ch10-go',
        title: 'Explore!',
        content: "Toggle constituents. Change stations. Speed up time. The ocean's rhythm is yours to discover.",
        duration: 0,
        camera: { position: [55, 35, 55], target: [0, 0, 0], duration: 2 },
        showTidalBulge: true,
        tidalExaggeration: 50000,
        showOrbits: true,
        timeSpeed: 86400,
        interactive: true,
      },
    ],
  },
];

export const CHAPTER_COUNT = TUTORIAL_CHAPTERS.length;

export function getChapter(index: number): TutorialChapter | undefined {
  return TUTORIAL_CHAPTERS[index];
}

export function getStep(
  chapterIndex: number,
  stepIndex: number
): { chapter: TutorialChapter; step: (typeof TUTORIAL_CHAPTERS)[0]['steps'][0] } | undefined {
  const chapter = TUTORIAL_CHAPTERS[chapterIndex];
  if (!chapter) return undefined;
  const step = chapter.steps[stepIndex];
  if (!step) return undefined;
  return { chapter, step };
}
